<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gesti√≥n Audio - Dashboard General</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050816;
      --bg-sidebar: #020617;
      --bg-card: #0f172a;
      --bg-card-soft: #111827;
      --accent: #ef4444;
      --accent-soft: #fecaca;
      --accent-warn: #f97316;
      --accent-danger: #ef4444;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-soft: #1f2937;
      --radius-lg: 14px;
      --radius-xl: 18px;
      --shadow-soft: 0 14px 30px rgba(0,0,0,.45);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    body {
      background: radial-gradient(circle at top left, #1f2937, #020617 45%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
    }

    body.light-theme {
      --bg: #f3f4f6;
      --bg-sidebar: #000000;
      --bg-card: #ffffff;
      --bg-card-soft: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: #d1d5db;
      background: #f3f4f6;
      color: var(--text-main);
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: linear-gradient(180deg, var(--bg-sidebar), var(--bg-sidebar) 40%, var(--bg-sidebar));
      border-right: 1px solid var(--border-soft);
      padding: 20px 18px 24px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fecaca, #b91c1c);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      color: #fef2f2;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-title {
      font-weight: 800;
      font-size: 1.05rem;
      letter-spacing: .03em;
    }

    .logo-title span {
      display: inline-block;
    }

    .logo-title-gestion {
      color: #f97316;
    }

    .logo-title-audio {
      color: #38bdf8;
      margin-left: 2px;
    }

    .logo-subtitle {
      font-size: .7rem;
      color: var(--text-muted);
    }

    .module-badge {
      margin-top: 4px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: .78rem;
      padding: 6px 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, #ef4444, #f97316);
      color: #fef2f2;
      border: 1px solid #b91c1c;
    }

    .module-badge-icon {
      font-size: .9rem;
    }

    .side-nav {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .side-nav-item {
      width: 100%;
      text-align: left;
      background: transparent;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      padding: 7px 10px;
      font-size: .8rem;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background .15s ease, color .15s ease, border-color .15s ease;
    }

    .side-nav-item span.icon {
      font-size: .9rem;
    }

    .side-nav-item:hover {
      background: rgba(15,23,42,0.75);
      color: #e5e7eb;
    }

    .side-nav-item.active {
      background: rgba(239,68,68,0.1);
      border-color: #ef4444;
      color: #fef2f2;
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: .78rem;
      color: var(--text-muted);
    }

    /* Main */
    .main {
      flex: 1;
      padding: 18px 22px 26px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .topbar {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: flex-end;
    }

    .btn {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid #ef4444;
      font-size: .78rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #ef4444;
      color: #fef2f2;
      box-shadow: none;
      transition: background .15s ease, transform .08s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      background: #dc2626;
    }

    .btn-cta {
      font-weight: 600;
    }

    .btn span.icon {
      font-size: .85rem;
    }

    body.light-theme .btn {
      background: #ef4444;
      color: #fef2f2;
      border-color: #ef4444;
    }

    .filters-row {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      font-size: .8rem;
      margin-top: 6px;
    }

    .select {
      background: rgba(15,23,42,.95);
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      outline: none;
      font-size: .8rem;
    }

    body.light-theme .select {
      background: #ffffff;
      color: #111827;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .section-header h2 {
      font-size: 1.08rem;
      font-weight: 600;
    }

    .section-header span.sub {
      font-size: .78rem;
      color: var(--text-muted);
    }

    /* Views */
    .view {
      display: none;
    }
    .view.active {
      display: block;
    }

    /* KPI pills */
    .kpi-row {
      display: flex;
      flex-wrap: nowrap;
      gap: 8px;
      margin-top: 10px;
      margin-bottom: 2px;
      overflow-x: auto;
      padding-bottom: 4px;
      -webkit-overflow-scrolling: touch;
    }

    .kpi-row::-webkit-scrollbar {
      height: 4px;
    }
    .kpi-row::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.7);
      border-radius: 999px;
    }

    .kpi-pill {
      display: inline-flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      padding: 5px 10px;
      border-radius: 999px;
      font-size: .76rem;
      cursor: default;
      border: 1px solid #b91c1c;
      background: #ef4444;
      color: #fef2f2;
      box-shadow: 0 4px 10px rgba(239,68,68,0.45);
      min-width: 150px;
      flex-shrink: 0;
    }

    body.light-theme .kpi-pill {
      background: #ef4444;
      color: #fef2f2;
      box-shadow: 0 4px 10px rgba(239,68,68,0.35);
    }

    .kpi-main-block {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .kpi-label {
      opacity: .9;
    }

    .kpi-value {
      font-weight: 700;
      font-size: .8rem;
    }

    .kpi-status {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid rgba(248,250,252,0.9);
      background: rgba(15,23,42,0.28);
    }

    .kpi-status-icon {
      font-size: .7rem;
    }

    .kpi-status.optimo {
      background: rgba(22,163,74,0.15);
    }

    .kpi-status.muybien {
      background: rgba(234,179,8,0.15);
    }

    .kpi-status.mejorable {
      background: rgba(220,38,38,0.2);
    }

    /* Cards y gr√°ficos */
    .card {
      background: radial-gradient(circle at top left, var(--bg-card-soft), #020617 55%);
      border-radius: var(--radius-xl);
      padding: 14px 14px 12px;
      border: 1px solid rgba(15,23,42,.9);
      box-shadow: var(--shadow-soft);
      position: relative;
    }

    body.light-theme .card {
      background: #ffffff;
      border-color: #e5e7eb;
      box-shadow: 0 10px 25px rgba(15,23,42,.12);
    }

    .card h3 {
      font-size: .9rem;
      margin-bottom: 4px;
    }

    .card-sub {
      font-size: .76rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .card-badge {
      position: absolute;
      top: 12px;
      right: 14px;
      font-size: .68rem;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(148,163,184,0.22);
      color: var(--text-muted);
    }

    .grid-main {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
      gap: 16px;
      align-items: stretch;
      margin-top: 8px;
    }

    .grid-bottom {
      margin-top: 16px;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
      gap: 16px;
      align-items: stretch;
    }

    .chart-container {
      position: relative;
      height: 230px;
      width: 100%;
    }

    .chart-container.tall {
      height: 260px;
    }

    /* Criterios procesos */
    .criteria-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: .76rem;
      max-height: 210px;
      overflow-y: auto;
    }

    .criteria-list::-webkit-scrollbar {
      width: 4px;
    }
    .criteria-list::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.7);
      border-radius: 999px;
    }

    .criteria-item {
      display: flex;
      gap: 6px;
      align-items: flex-start;
    }

    .criteria-index {
      min-width: 1.5rem;
      height: 1.4rem;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .7rem;
      flex-shrink: 0;
    }

    body.light-theme .criteria-index {
      background: #111827;
      color: #f9fafb;
    }

    .criteria-text {
      flex: 1;
      color: var(--text-main);
      opacity: .9;
    }

    body.light-theme .criteria-text {
      color: #111827;
    }

    .criteria-footer {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: .7rem;
      color: var(--text-muted);
    }

    .criteria-btn {
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid rgba(148,163,184,0.9);
      background: transparent;
      color: inherit;
      font-size: .72rem;
      cursor: pointer;
    }

    .criteria-btn:hover {
      background: rgba(148,163,184,0.12);
    }

    /* ----- GESTOR DE VISITAS (segunda pantalla) ----- */

    .visit-planning-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.2fr);
      gap: 16px;
      margin-top: 10px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: .82rem;
    }

    .calendar-nav-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: transparent;
      color: var(--text-main);
      font-size: .76rem;
      padding: 2px 8px;
      cursor: pointer;
    }

    .calendar-nav-btn:hover {
      background: rgba(148,163,184,0.16);
    }

    .calendar-month {
      font-weight: 600;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0,1fr));
      gap: 2px;
      font-size: .7rem;
    }

    .calendar-day-name {
      text-align: center;
      padding: 4px 0;
      color: var(--text-muted);
    }

    .calendar-cell {
      height: 32px;
      border-radius: 8px;
      text-align: right;
      padding: 4px 6px;
      cursor: pointer;
      position: relative;
      border: 1px solid transparent;
    }

    .calendar-cell span.date-number {
      font-size: .74rem;
    }

    .calendar-cell:hover {
      background: rgba(148,163,184,0.15);
    }

    .calendar-cell-today {
      border-color: #ef4444;
      background: rgba(239,68,68,0.08);
    }

    .calendar-cell-empty {
      cursor: default;
    }

    .calendar-cell-empty:hover {
      background: transparent;
    }

    .calendar-dot {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #fbbf24;
      left: 6px;
      bottom: 4px;
    }

    .pending-visits {
      margin-top: 10px;
      border-top: 1px solid rgba(148,163,184,0.3);
      padding-top: 8px;
    }

    .pending-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: .8rem;
      margin-bottom: 6px;
    }

    .pending-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 160px;
      overflow-y: auto;
      font-size: .76rem;
    }

    .pending-row {
      display: grid;
      grid-template-columns: minmax(0,1.4fr) minmax(0,1.2fr) auto auto;
      gap: 6px;
      align-items: center;
      padding: 4px 6px;
      border-radius: 10px;
      background: rgba(15,23,42,0.8);
    }

    .pending-date {
      font-weight: 600;
    }
    .pending-centro {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pending-status {
      font-size: .7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(234,179,8,0.2);
      border: 1px solid rgba(234,179,8,0.8);
      color: #facc15;
    }

    .pending-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      background: transparent;
      color: #e5e7eb;
      font-size: .72rem;
      padding: 3px 8px;
      cursor: pointer;
    }

    .pending-btn:hover {
      background: rgba(148,163,184,0.2);
    }

    .pending-empty {
      font-size: .74rem;
      color: var(--text-muted);
    }

    /* Centros */
    .centros-list {
      list-style: none;
      margin-top: 6px;
      padding-left: 0;
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: .76rem;
      max-height: 170px;
      overflow-y: auto;
    }

    .centros-list li {
      padding: 2px 4px;
      border-radius: 6px;
      background: rgba(15,23,42,0.7);
    }

    body.light-theme .centros-list li {
      background: #f3f4f6;
    }

    .centros-actions {
      display: flex;
      gap: 6px;
      margin-top: 6px;
    }

    .centros-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text-main);
      font-size: .76rem;
      padding: 4px 8px;
      outline: none;
    }

    body.light-theme .centros-input {
      background: #f9fafb;
      color: #111827;
      border-color: #d1d5db;
    }

    .centros-add-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      background: transparent;
      color: #e5e7eb;
      font-size: .76rem;
      padding: 4px 8px;
      cursor: pointer;
    }

    .centros-add-btn:hover {
      background: rgba(148,163,184,0.2);
    }

    .centros-file {
      margin-top: 4px;
      font-size: .74rem;
    }

    /* Modal agendar visita */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9998;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: #020617;
      border-radius: 16px;
      padding: 14px 16px 12px;
      border: 1px solid rgba(148,163,184,0.7);
      width: 320px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.65);
      font-size: .8rem;
    }

    body.light-theme .modal-content {
      background: #ffffff;
      color: #111827;
    }

    .modal-content h3 {
      margin-bottom: 6px;
      font-size: .9rem;
    }

    .modal-sub {
      font-size: .74rem;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .visit-field {
      display: flex;
      flex-direction: column;
      gap: 3px;
      margin-bottom: 6px;
    }

    .visit-label {
      font-size: .72rem;
      color: var(--text-muted);
    }

    .visit-input,
    .visit-select,
    .visit-textarea {
      background: #020617;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 5px 8px;
      font-size: .78rem;
      color: var(--text-main);
      outline: none;
    }

    .visit-textarea {
      min-height: 80px;
      resize: vertical;
    }

    body.light-theme .visit-input,
    body.light-theme .visit-select,
    body.light-theme .visit-textarea {
      background: #f9fafb;
      color: #111827;
      border-color: #d1d5db;
    }

    .modal-actions {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
    }

    .modal-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.8);
      background: transparent;
      color: #e5e7eb;
      font-size: .76rem;
      padding: 4px 10px;
      cursor: pointer;
    }

    .modal-btn.primary {
      border-color: #ef4444;
      background: #ef4444;
      color: #fef2f2;
    }

    .modal-btn:hover {
      background: rgba(148,163,184,0.2);
    }

    .modal-btn.primary:hover {
      background: #dc2626;
    }

    /* Informe visitas (segunda vista) */
    .visit-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.6fr);
      gap: 12px;
      margin-top: 10px;
      font-size: .78rem;
    }

    .visit-meta-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }

    .visit-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .visit-tag {
      font-size: .7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.8);
      background: rgba(15,23,42,0.6);
    }

    body.light-theme .visit-tag {
      background: #f3f4f6;
    }

    .visit-charts-grid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 10px;
    }

    .chart-box {
      border-radius: 14px;
      padding: 8px;
      background: rgba(15,23,42,0.7);
      border: 1px solid rgba(15,23,42,0.9);
      position: relative;
    }

    body.light-theme .chart-box {
      background: #ffffff;
      border-color: #e5e7eb;
    }

    .chart-box h4 {
      font-size: .78rem;
      margin-bottom: 4px;
    }

    .chart-tag {
      position: absolute;
      top: 6px;
      right: 8px;
      font-size: .66rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(148,163,184,0.25);
      color: var(--text-muted);
    }

    .chart-box .chart-container {
      height: 150px;
    }

    /* Adjuntar im√°genes */
    .images-grid {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 8px;
    }

    .image-slot {
      border-radius: 14px;
      border: 1px dashed rgba(148,163,184,0.8);
      padding: 10px;
      font-size: .74rem;
      text-align: center;
    }

    .image-slot input {
      margin-top: 6px;
      width: 100%;
      font-size: .74rem;
    }

    /* Check interno + observaciones */
    .visit-bottom-grid {
      margin-top: 12px;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
      gap: 12px;
      align-items: stretch;
    }

    .check-groups {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 10px;
      font-size: .76rem;
      max-height: 260px;
      overflow-y: auto;
    }

    .check-group-title {
      font-size: .78rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .check-list {
      list-style: none;
      padding-left: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .check-list li {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .check-list input[type="checkbox"] {
      transform: scale(0.9);
    }

    .observaciones-area {
      width: 100%;
      height: 260px;
      resize: vertical;
      font-size: .78rem;
    }

    .visit-footer {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: .76rem;
    }

    .historial-card {
      margin-top: 10px;
      font-size: .78rem;
    }

    .historial-list {
      list-style: none;
      padding-left: 0;
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: .76rem;
    }

    .historial-item {
      padding: 4px 6px;
      border-radius: 10px;
      background: rgba(15,23,42,0.8);
    }

    body.light-theme .historial-item {
      background: #f3f4f6;
    }

    /* Toasts */
    .toast {
      position: fixed;
      right: 18px;
      bottom: 18px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(15,23,42,.95);
      border: 1px solid rgba(148,163,184,.6);
      font-size: .8rem;
      color: var(--text-main);
      box-shadow: 0 10px 30px rgba(0,0,0,.5);
      opacity: 1;
      transition: opacity .3s ease, transform .3s ease;
      transform: translateY(0);
      z-index: 9999;
    }

    .toast.hide {
      opacity: 0;
      transform: translateY(6px);
    }

    .no-print {}

    /* Print styles */
    @media print {
      @page {
        size: A4 portrait;
        margin: 10mm;
      }
      body {
        background: #ffffff !important;
      }
      .sidebar,
      .topbar,
      .filters-row,
      .no-print {
        display: none !important;
      }
      .main {
        padding: 0 !important;
      }
      .card {
        box-shadow: none !important;
        margin-bottom: 6px;
      }
      .visit-bottom-grid .check-card {
        page-break-before: always;
      }
    }

    /* Responsivo */
    @media (max-width: 960px) {
      .sidebar {
        display: none;
      }
      body {
        display: block;
      }
      .main {
        padding: 14px;
      }
      .grid-main,
      .grid-bottom,
      .visit-planning-grid,
      .visit-layout,
      .visit-charts-grid,
      .images-grid,
      .visit-bottom-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-icon">üéß</div>
      <div class="logo-text">
        <div class="logo-title">
          <span class="logo-title-gestion">Gesti√≥n</span><span class="logo-title-audio"> Audio</span>
        </div>
        <span class="logo-subtitle">Dashboard general de procesos y KPIs</span>
      </div>
    </div>

    <div class="module-badge">
      <span class="module-badge-icon">üìä</span>
      <span>Dashboard general</span>
    </div>

    <nav class="side-nav">
      <button class="side-nav-item active" data-view="dashboard">
        <span class="icon">üìà</span> Dashboard general
      </button>
      <button class="side-nav-item" data-view="informes">
        <span class="icon">üóÇÔ∏è</span> Gestor de visitas
      </button>
    </nav>

    <div class="sidebar-footer">
      <p>Versi√≥n demo ¬∑ Datos ficticios</p>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- Topbar -->
    <div class="topbar no-print">
      <button class="btn" id="btnToggleTheme">
        <span class="icon">‚òÄÔ∏è</span> Modo claro
      </button>
      <button class="btn" id="btnSaveView">
        <span class="icon">üíæ</span> Guardar vista
      </button>
      <button class="btn" id="btnPrint">
        <span class="icon">üñ®Ô∏è</span> Imprimir
      </button>
      <button class="btn" id="btnExportHtml">
        <span class="icon">‚¨áÔ∏è</span> Exportar HTML
      </button>
      <button class="btn btn-cta" id="btnSyncCloud">
        <span class="icon">‚òÅÔ∏è</span> Actualizar datos nube
      </button>
    </div>

    <!-- Filtros (dashboard) -->
    <div class="filters-row no-print">
      <select class="select" id="selectCentro">
        <option value="todos">Centro: Todos</option>
        <option value="reina-mercedes">Madrid ¬∑ Reina Mercedes</option>
        <option value="tetuan">Madrid ¬∑ Tetu√°n</option>
        <option value="nervion">Sevilla ¬∑ Nervi√≥n</option>
        <option value="gran-via">Bilbao ¬∑ Gran V√≠a</option>
      </select>
      <select class="select" id="selectDelegado">
        <option value="todos">Delegado: Todos</option>
        <option value="blanca">Blanca</option>
        <option value="cecilia">Cecilia</option>
        <option value="daniel">Daniel</option>
        <option value="eneritz">Eneritz</option>
        <option value="luis">Luis</option>
      </select>
    </div>

    <!-- ====== VISTA 1: DASHBOARD GENERAL ====== -->
    <section id="view-dashboard" class="view active">
      <!-- Resumen general -->
      <div>
        <div class="section-header">
          <h2>Resumen general KPIs</h2>
          <span class="sub" id="resumenSub">
            Visi√≥n r√°pida de procesos, HIT, primeros auxilios, conversiones y formaciones
          </span>
        </div>

        <!-- KPIs -->
        <section class="kpi-row">
          <div class="kpi-pill" data-kpi-type="process">
            <div class="kpi-main-block">
              <span class="kpi-label">Procesos aplicados</span>
              <span class="kpi-value" id="kpiProcesos">92%</span>
            </div>
            <span class="kpi-status" title="">
              <span class="kpi-status-icon"></span>
            </span>
          </div>

          <div class="kpi-pill" data-kpi-type="process">
            <div class="kpi-main-block">
              <span class="kpi-label">HIT global</span>
              <span class="kpi-value" id="kpiHit">100%</span>
            </div>
            <span class="kpi-status" title="">
              <span class="kpi-status-icon"></span>
            </span>
          </div>

          <div class="kpi-pill" data-kpi-type="process">
            <div class="kpi-main-block">
              <span class="kpi-label">Primeros auxilios</span>
              <span class="kpi-value" id="kpiPrimerosAuxilios">63%</span>
            </div>
            <span class="kpi-status" title="">
              <span class="kpi-status-icon"></span>
            </span>
          </div>

          <div class="kpi-pill" data-kpi-type="conversion">
            <div class="kpi-main-block">
              <span class="kpi-label">Conv. a prueba</span>
              <span class="kpi-value" id="kpiConvPrueba">72%</span>
            </div>
            <span class="kpi-status" title="">
              <span class="kpi-status-icon"></span>
            </span>
          </div>

          <div class="kpi-pill" data-kpi-type="conversion">
            <div class="kpi-main-block">
              <span class="kpi-label">Conv. a venta</span>
              <span class="kpi-value" id="kpiConvVenta">81%</span>
            </div>
            <span class="kpi-status" title="">
              <span class="kpi-status-icon"></span>
            </span>
          </div>

          <div class="kpi-pill" data-kpi-type="process">
            <div class="kpi-main-block">
              <span class="kpi-label">Formaciones</span>
              <span class="kpi-value" id="kpiFormaciones">88%</span>
            </div>
            <span class="kpi-status" title="">
              <span class="kpi-status-icon"></span>
            </span>
          </div>
        </section>
      </div>

      <!-- Gr√°ficos principales -->
      <section class="grid-main">
        <!-- Evoluci√≥n mensual -->
        <article class="card">
          <span class="card-badge">% demo</span>
          <h3>Evoluci√≥n mensual de procesos y resultados</h3>
          <p class="card-sub">
            Barras de % procesos aplicados y curvas de HIT, conversi√≥n a prueba y conversi√≥n a venta
          </p>
          <div class="chart-container">
            <canvas id="chartEvolucion"></canvas>
          </div>
        </article>

        <!-- Estado de visitas -->
        <article class="card">
          <span class="card-badge">% demo</span>
          <h3>Estado de visitas</h3>
          <p class="card-sub">
            Distribuci√≥n de visitas realizadas, pendientes y anuladas ¬∑ Ene ‚Äì Dic
          </p>
          <div class="chart-container">
            <canvas id="chartVisitas"></canvas>
          </div>
        </article>

        <!-- √Årea de mejora -->
        <article class="card">
          <span class="card-badge">% demo</span>
          <h3>√Årea de mejora de procesos</h3>
          <p class="card-sub">
            Top 10 criterios con mayor porcentaje de procesos no aplicados
          </p>
          <div class="chart-container tall">
            <canvas id="chartAreaMejora"></canvas>
          </div>
        </article>

        <!-- Ranking delegados -->
        <article class="card">
          <span class="card-badge">% demo</span>
          <h3>Ranking por delegados ¬∑ √≠ndice global</h3>
          <p class="card-sub">
            √çndice global promedio de todos sus centros evaluados ¬∑ Top 5 delegados
          </p>
          <div class="chart-container tall">
            <canvas id="chartDelegados"></canvas>
          </div>
        </article>
      </section>

      <!-- Bloque inferior: indicadores + criterios -->
      <section class="grid-bottom">
        <!-- % Procesos, HIT y ARR -->
        <article class="card">
          <span class="card-badge">% demo</span>
          <h3>Indicadores globales ¬∑ Procesos, HIT y ARR</h3>
          <p class="card-sub">
            % global de procesos aplicados, HIT y ARR en el conjunto de centros evaluados
          </p>
          <div class="chart-container">
            <canvas id="chartProcesosHitArr"></canvas>
          </div>
        </article>

        <!-- Criterios procesos -->
        <article class="card">
          <h3>Criterios de procesos evaluados</h3>
          <p class="card-sub">
            Checklist unificada (Corner + Exclusivo). Se muestran primero los criterios comunes en el orden Corner.
          </p>
          <ul id="listaCriterios" class="criteria-list"></ul>
          <div class="criteria-footer">
            <small id="criteriaResumen"></small>
            <button class="criteria-btn" id="btnVerMasCriteria">Expandir a altura completa</button>
          </div>
        </article>
      </section>
    </section>

    <!-- ====== VISTA 2: GESTOR DE VISITAS / INFORMES ====== -->
    <section id="view-informes" class="view">
      <div class="section-header">
        <h2>Gestor de visitas e informes</h2>
        <span class="sub">
          Planificaci√≥n de visitas, carga de centros y generaci√≥n del informe de visita
        </span>
      </div>

      <!-- Planificaci√≥n: calendario + centros -->
      <section class="visit-planning-grid no-print">
        <!-- Calendario + visitas pendientes -->
        <article class="card">
          <h3>Calendario de visitas</h3>
          <p class="card-sub">
            Selecciona un d√≠a del mes actual y agenda una visita con centro y responsable Audio.
          </p>
          <div class="calendar-header">
            <button class="calendar-nav-btn" id="calPrev">&lt;</button>
            <span class="calendar-month" id="calMonthLabel">Mes</span>
            <button class="calendar-nav-btn" id="calNext">&gt;</button>
          </div>
          <div class="calendar-grid" id="calendarGrid"></div>

          <div class="pending-visits">
            <div class="pending-header">
              <span>Visitas pendientes</span>
              <small style="color:var(--text-muted);">Estado √°mbar ¬∑ demo</small>
            </div>
            <div class="pending-list" id="listaVisitasPendientes"></div>
          </div>
        </article>

        <!-- Centros -->
        <article class="card">
          <h3>Centros (adjuntar Excel)</h3>
          <p class="card-sub">
            Carga fija de centros desde Excel (demo) y a√±ade centros manualmente para usarlos en el calendario.
          </p>
          <div class="centros-file">
            <label for="inputExcelCentros">Adjuntar fichero Excel (demo):</label><br />
            <input type="file" id="inputExcelCentros" />
          </div>
          <div class="centros-actions">
            <input id="nuevoCentroInput" class="centros-input" placeholder="A√±adir centro manualmente..." />
            <button class="centros-add-btn" id="btnAddCentro">A√±adir</button>
          </div>
          <ul class="centros-list" id="listaCentros"></ul>
          <small style="font-size:.7rem;color:var(--text-muted);">
            Nota: lectura real del Excel pendiente de conexi√≥n ¬∑ ahora se usa listado demo/local.
          </small>
          <datalist id="centrosList"></datalist>
        </article>
      </section>

      <!-- INFORME DE VISITAS -->
      <article class="card" id="informeVisitasSection">
        <h3>Informe de visita</h3>
        <p class="card-sub">
          Al crear un informe desde una visita pendiente se rellenan autom√°ticamente los datos de cabecera (demo).
        </p>

        <!-- Cabecera informe -->
        <div class="visit-layout">
          <!-- Columna izquierda -->
          <div>
            <div class="visit-meta-grid">
              <div class="visit-field">
                <span class="visit-label">Centro</span>
                <input id="informeCentro" class="visit-input" placeholder="Centro de la visita" />
              </div>
              <div class="visit-field">
                <span class="visit-label">Delegado</span>
                <input id="informeDelegado" class="visit-input" placeholder="Nombre del delegado" />
              </div>
            </div>

            <div class="visit-meta-grid" style="margin-top:6px;">
              <div class="visit-field">
                <span class="visit-label">Responsable Audio</span>
                <select id="informeResponsableAudio" class="visit-select">
                  <option value="">Selecciona responsable...</option>
                  <option value="Ariannys Rojas">Ariannys Rojas</option>
                  <option value="Sonia Guasque">Sonia Guasque</option>
                </select>
              </div>
              <div class="visit-field">
                <span class="visit-label">Fecha visita</span>
                <input type="date" id="informeFecha" class="visit-input" />
              </div>
            </div>
          </div>

          <!-- Columna derecha -->
          <div>
            <div class="visit-meta-grid">
              <div class="visit-field">
                <span class="visit-label">Tipo de centro</span>
                <select id="informeTipoCentro" class="visit-select">
                  <option value="">Corner o Exclusivo...</option>
                  <option value="Corner">Corner</option>
                  <option value="Exclusivo">Exclusivo</option>
                </select>
              </div>
              <div class="visit-field">
                <span class="visit-label">Centro AAR</span>
                <select id="informeCentroAAR" class="visit-select">
                  <option value="">¬øCentro AAR?</option>
                  <option value="Si">S√≠</option>
                  <option value="No">No</option>
                </select>
              </div>
            </div>
            <div class="visit-field" style="margin-top:6px;">
              <span class="visit-label">Checklist evaluaci√≥n (adjuntar fichero)</span>
              <input type="file" id="informeChecklistFile" class="visit-input" />
            </div>
          </div>
        </div>

        <!-- Gr√°ficos del informe -->
        <div class="visit-charts-grid">
          <div class="chart-box">
            <span class="chart-tag">% demo</span>
            <h4>Radar de resultados</h4>
            <div class="chart-container">
              <canvas id="chartRadarInforme"></canvas>
            </div>
          </div>
          <div class="chart-box">
            <span class="chart-tag">% demo</span>
            <h4>√Åreas de mejora de procesos</h4>
            <div class="chart-container">
              <canvas id="chartAreaMejoraInforme"></canvas>
            </div>
          </div>
          <div class="chart-box">
            <span class="chart-tag">% demo</span>
            <h4>KPIs de negocio visita</h4>
            <div class="chart-container">
              <canvas id="chartKpiInforme"></canvas>
            </div>
          </div>
        </div>

        <!-- Adjuntar im√°genes -->
        <div class="images-grid">
          <div class="image-slot">
            <strong>Imagen 1</strong>
            <div style="font-size:.7rem;color:var(--text-muted);margin-top:2px;">Foto escaparate / PDV</div>
            <input type="file" />
          </div>
          <div class="image-slot">
            <strong>Imagen 2</strong>
            <div style="font-size:.7rem;color:var(--text-muted);margin-top:2px;">Zona gabinete / audio</div>
            <input type="file" />
          </div>
          <div class="image-slot">
            <strong>Imagen 3</strong>
            <div style="font-size:.7rem;color:var(--text-muted);margin-top:2px;">Otro detalle relevante</div>
            <input type="file" />
          </div>
        </div>

        <!-- Check interno + observaciones (2¬™ p√°gina en impresi√≥n) -->
        <div class="visit-bottom-grid">
          <!-- Check interno -->
          <article class="card check-card">
            <h3>Check interno (demo)</h3>
            <p class="card-sub">
              Formaciones y elementos de producto/comunicaci√≥n revisados durante la visita. El checklist completo se puede adjuntar al informe.
            </p>
            <div class="check-groups">
              <div>
                <div class="check-group-title">Formaciones y habilidades</div>
                <ul class="check-list">
                  <li><input type="checkbox" /> <span>WSA</span></li>
                  <li><input type="checkbox" /> <span>Starkey</span></li>
                  <li><input type="checkbox" /> <span>Habilidades comerciales / Neuroventas</span></li>
                  <li><input type="checkbox" /> <span>HIT</span></li>
                  <li><input type="checkbox" /> <span>Telecare</span></li>
                  <li><input type="checkbox" /> <span>PIA</span></li>
                  <li><input type="checkbox" /> <span>Telehear</span></li>
                  <li><input type="checkbox" /> <span>Financiaci√≥n Infinity</span></li>
                  <li><input type="checkbox" /> <span>Venta de seguro</span></li>
                  <li><input type="checkbox" /> <span>Primeros auxilios (equipo)</span></li>
                </ul>
              </div>
              <div>
                <div class="check-group-title">Producto y comunicaci√≥n</div>
                <ul class="check-list">
                  <li><input type="checkbox" /> <span>Audiometr√≠a RT</span></li>
                  <li><input type="checkbox" /> <span>Test de lectura audio</span></li>
                  <li><input type="checkbox" /> <span>Screening audio</span></li>
                  <li><input type="checkbox" /> <span>Manteleta audio</span></li>
                  <li><input type="checkbox" /> <span>Escaparate visible audio</span></li>
                  <li><input type="checkbox" /> <span>Salud auditiva en PDV</span></li>
                  <li><input type="checkbox" /> <span>Elementos Renove</span></li>
                  <li><input type="checkbox" /> <span>Elementos MGM</span></li>
                  <li><input type="checkbox" /> <span>Stock</span></li>
                  <li><input type="checkbox" /> <span>Tchin Tchin</span></li>
                </ul>
              </div>
            </div>
            <div class="visit-field" style="margin-top:8px;">
              <span class="visit-label">Adjuntar check interno completo (Excel / PDF)</span>
              <input type="file" class="visit-input" />
            </div>
          </article>

          <!-- Observaciones -->
          <article class="card">
            <h3>Observaciones, recomendaciones y compromisos</h3>
            <textarea id="informeObservaciones" class="visit-textarea observaciones-area" placeholder="Espacio de texto libre para observaciones clave, acuerdos con el centro, compromisos y pr√≥ximos pasos (demo)."></textarea>
          </article>
        </div>

        <!-- Footer informe -->
        <div class="visit-footer">
          <small style="color:var(--text-muted);">
            Los porcentajes mostrados en las gr√°ficas son datos demo hasta conectar con el checklist real.
          </small>
          <button class="btn" id="btnGuardarInforme">
            <span class="icon">üíæ</span> Guardar informe
          </button>
        </div>

        <!-- Historial de informes -->
        <article class="card historial-card no-print">
          <h3>Historial de informes (demo local)</h3>
          <ul class="historial-list" id="historialInformesList"></ul>
        </article>
      </article>
    </section>
  </main>

  <!-- Modal agendar visita -->
  <div id="visitModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-content">
      <h3>Agendar visita</h3>
      <div class="modal-sub">
        Fecha seleccionada: <span id="visitModalFecha"></span>
      </div>
      <div class="visit-field">
        <span class="visit-label">Centro (buscar en listado)</span>
        <input id="visitCentroInput" class="visit-input" list="centrosList" placeholder="Escribe para buscar centro..." />
      </div>
      <div class="visit-field">
        <span class="visit-label">Responsable Audio</span>
        <select id="visitResponsableSelect" class="visit-select">
          <option value="">Selecciona responsable...</option>
          <option value="Ariannys Rojas">Ariannys Rojas</option>
          <option value="Sonia Guasque">Sonia Guasque</option>
        </select>
      </div>
      <div class="modal-actions">
        <button class="modal-btn" id="btnCancelarVisita">Cancelar</button>
        <button class="modal-btn primary" id="btnGuardarVisitaModal">Guardar visita</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- GR√ÅFICOS DASHBOARD (Chart.js) ----------
    const ctxEvo = document.getElementById('chartEvolucion').getContext('2d');
    const chartEvolucion = new Chart(ctxEvo, {
      type: 'bar',
      data: {
        labels: ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],
        datasets: [
          {
            type: 'bar',
            label: '% Procesos aplicados',
            data: [78, 80, 81, 82, 83, 84, 85, 86, 87, 88, 87, 88],
            backgroundColor: 'rgba(100,116,139,0.9)',
            borderRadius: 6
          },
          {
            type: 'line',
            label: '% HIT',
            data: [76, 77, 78, 79, 80, 81, 82, 83, 84, 83, 82, 82],
            borderColor: '#ef4444',
            borderWidth: 3,
            tension: 0.35,
            fill: false,
            pointRadius: 2
          },
          {
            type: 'line',
            label: '% Conversi√≥n a prueba',
            data: [32, 33, 34, 35, 36, 37, 38, 39, 40, 40, 39, 40],
            borderColor: '#0ea5e9',
            borderWidth: 3,
            tension: 0.35,
            fill: false,
            pointRadius: 2
          },
          {
            type: 'line',
            label: '% Conversi√≥n a venta',
            data: [21, 22, 23, 24, 25, 26, 27, 27, 28, 27, 26, 27],
            borderColor: '#a855f7',
            borderWidth: 3,
            tension: 0.35,
            fill: false,
            pointRadius: 2
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            align: 'center',
            labels: {
              usePointStyle: true,
              color: '#e5e7eb',
              font: { size: 11, weight: 'bold' }
            }
          },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y}%`
            }
          }
        },
        scales: {
          x: {
            ticks: { color: '#9ca3af', font: { size: 10 } },
            grid: { color: 'rgba(31,41,55,0.35)' }
          },
          y: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 },
              callback: value => value + '%'
            },
            grid: { color: 'rgba(31,41,55,0.35)' },
            suggestedMin: 0,
            suggestedMax: 100
          }
        }
      }
    });

    const ctxVis = document.getElementById('chartVisitas').getContext('2d');
    const chartVisitas = new Chart(ctxVis, {
      type: 'doughnut',
      data: {
        labels: ['Realizadas', 'Pendientes', 'Anuladas'],
        datasets: [{
          data: [72, 19, 9],
          borderWidth: 0,
          backgroundColor: [
            'rgba(59,130,246,0.9)',
            'rgba(234,179,8,0.9)',
            'rgba(239,68,68,0.9)'
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: { color: '#e5e7eb', font: { size: 11, weight: 'bold' } }
          },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.label}: ${ctx.parsed}%`
            }
          }
        },
        cutout: '65%'
      }
    });

    const ctxArea = document.getElementById('chartAreaMejora').getContext('2d');
    const chartAreaMejora = new Chart(ctxArea, {
      type: 'bar',
      data: {
        labels: [
          'Seguimiento a 7 d√≠as',
          'Entrega folleto HIT',
          'Simulaci√≥n financiaci√≥n',
          'Registro motivo no venta',
          'Uso guion ACE',
          'Teleaudiometr√≠a',
          'Derivaci√≥n ORL',
          'Plan fidelizaci√≥n',
          'Registro competidor',
          'Revisi√≥n preventiva'
        ],
        datasets: [{
          label: '% procesos no aplicados',
          data: [38, 34, 31, 29, 27, 25, 22, 20, 18, 15],
          backgroundColor: 'rgba(239,68,68,0.9)',
          borderRadius: 6
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: '#e5e7eb', font: { size: 11, weight: 'bold' } }
          },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.parsed.x}% no aplicado`
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 },
              callback: value => value + '%'
            },
            grid: { color: 'rgba(31,41,55,0.35)' },
            suggestedMin: 0,
            suggestedMax: 100
          },
          y: {
            ticks: { color: '#9ca3af', font: { size: 10 } },
            grid: { display: false }
          }
        }
      }
    });

    const ctxDel = document.getElementById('chartDelegados').getContext('2d');
    const labelsDelegados = ['Blanca', 'Cecilia', 'Daniel', 'Eneritz', 'Luis'];
    const dataIndiceGlobal = [87, 92, 80, 85, 77];

    const chartDelegados = new Chart(ctxDel, {
      type: 'bar',
      data: {
        labels: labelsDelegados,
        datasets: [{
          label: '% √≠ndice global delegado',
          data: dataIndiceGlobal,
          backgroundColor: [
            'rgba(59,130,246,0.9)',
            'rgba(239,68,68,0.9)',
            'rgba(14,165,233,0.9)',
            'rgba(168,85,247,0.9)',
            'rgba(234,179,8,0.9)'
          ],
          borderRadius: 5
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: '#e5e7eb', font: { size: 11, weight: 'bold' } }
          },
          tooltip: {
            callbacks: { label: ctx => `${ctx.parsed.y}% ¬∑ √≠ndice global` }
          }
        },
        scales: {
          x: {
            ticks: { color: '#9ca3af', font: { size: 10 } },
            grid: { color: 'rgba(31,41,55,0.35)' }
          },
          y: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 },
              callback: value => value + '%'
            },
            grid: { color: 'rgba(31,41,55,0.35)' },
            suggestedMin: 50,
            suggestedMax: 100
          }
        }
      }
    });

    const ctxPHA = document.getElementById('chartProcesosHitArr').getContext('2d');
    const chartProcesosHitArr = new Chart(ctxPHA, {
      type: 'bar',
      data: {
        labels: ['Procesos', 'HIT', 'ARR'],
        datasets: [{
          label: '% global',
          data: [84, 81, 68],
          backgroundColor: [
            'rgba(59,130,246,0.9)',
            'rgba(239,68,68,0.9)',
            'rgba(168,85,247,0.9)'
          ],
          borderRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: '#e5e7eb', font: { size: 11, weight: 'bold' } }
          },
          tooltip: {
            callbacks: { label: ctx => `${ctx.parsed.y}%` }
          }
        },
        scales: {
          x: {
            ticks: { color: '#9ca3af', font: { size: 10 } },
            grid: { color: 'rgba(31,41,55,0.35)' }
          },
          y: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 },
              callback: value => value + '%'
            },
            grid: { color: 'rgba(31,41,55,0.35)' },
            suggestedMin: 50,
            suggestedMax: 100
          }
        }
      }
    });

    // ---------- Criterios de procesos (lista) ----------
    const CRITERIOS_PROCESOS = [
      "Acogida al cliente con una sonrisa, amable y cercano",
      "Llamar al paciente por su nombre",
      "Acompa√±ar al paciente al gabinete para la revisi√≥n auditiva",
      "Ofrecer pasar a gabinete al acompa√±ante",
      "Confirmar motivo de visita",
      "Preguntar c√≥mo nos ha conocido",
      "Presentarnos por nombre, especialidad",
      "Presentar a la Compa√±√≠a, su expansi√≥n y calidad de equipos y producto",
      "Abrir ficha y Rellenar RGPD completa (incluido cheks condiciones comerciales)",
      "Realizar anamnesis HACE (H√°bitos, Antecedentes, Cl√≠nica, Expectativas)",
      "Explicar que realizamos un examen auditivo completo y en qu√© consiste",
      "Equipos previamente desinfectados",
      "Explicar brevemente cada prueba y asegurarnos que lo ha entendido",
      "Evaluar ambos o√≠dos con la videotoscopia",
      "Realizar timpanometr√≠a",
      "Realizar VA-VO-UCL",
      "Realizar logoaudiometr√≠a",
      "Resumir resultados y explicar con ayuda de gr√°ficas",
      "Vincular resultados con s√≠ntomas comentados en la anamnesis",
      "Simular sonidos para hacer visible la p√©rdida auditiva",
      "Explicar la prueba de capacidades auditivas (prueba HIT / ARR) como demo",
      "Disponer de stock de aud√≠fonos seg√∫n agenda y tr√°fico",
      "Escoger aud√≠fono seg√∫n perfil en gama recomendada",
      "Realizar programaci√≥n inicial y ajustes seg√∫n perfil",
      "Explicar manejo b√°sico de los aud√≠fonos al cliente",
      "Entregar documentaci√≥n (contrato, presupuesto, pasaporte)",
      "Registrar la prueba en el sistema (Gio)",
      "Explicar pol√≠tica comercial (segunda pareja, compromisos, etc.)",
      "Informar que se llamar√° al d√≠a siguiente para seguimiento",
      "Citar revisi√≥n a los 4 d√≠as",
      "Explicar qu√© anotar en el pasaporte (me molesta / estoy bien, etc.)",
      "Resaltar logros de expectativas y ajustes en cada visita",
      "Resolver objeciones",
      "Explicar facilidades de pago (Infinity, NextYear, etc.)",
      "Resumir compromisos y packs Serenidad / Serenidad + / HIT",
      "Recomendar igualar gama de segunda pareja",
      "Entregar kit de higiene y ense√±ar su uso",
      "Ofrecer ajustes en remoto a los 3 y 6 meses",
      "Revisi√≥n a 7 d√≠as tras la adaptaci√≥n",
      "Revisi√≥n al mes",
      "Revisi√≥n a los 3 meses",
      "Revisi√≥n cada 6/12 meses",
      "Control de satisfacci√≥n y NPS",
      "Registrar devoluciones y motivo",
      "Registrar derivaciones a ORL",
      "Registrar reubicaciones a otros centros",
      "Teleaudiometr√≠a activada y explicada",
      "Uso de recordatorios SMS / email para citas",
      "Plan de fidelizaci√≥n aplicado",
      "Registro de competidor mencionado por el cliente",
      "Criterio proceso demo 51",
      "Criterio proceso demo 52",
      "Criterio proceso demo 53",
      "Criterio proceso demo 54",
      "Criterio proceso demo 55",
      "Criterio proceso demo 56",
      "Criterio proceso demo 57",
      "Criterio proceso demo 58",
      "Criterio proceso demo 59",
      "Criterio proceso demo 60",
      "Criterio proceso demo 61",
      "Criterio proceso demo 62",
      "Criterio proceso demo 63",
      "Criterio proceso demo 64",
      "Criterio proceso demo 65",
      "Criterio proceso demo 66",
      "Criterio proceso demo 67",
      "Criterio proceso demo 68",
      "Criterio proceso demo 69",
      "Criterio proceso demo 70",
      "Criterio proceso demo 71",
      "Criterio proceso demo 72",
      "Criterio proceso demo 73",
      "Criterio proceso demo 74",
      "Criterio proceso demo 75",
      "Criterio proceso demo 76",
      "Criterio proceso demo 77",
      "Criterio proceso demo 78",
      "Criterio proceso demo 79",
      "Criterio proceso demo 80",
      "Criterio proceso demo 81",
      "Criterio proceso demo 82",
      "Criterio proceso demo 83",
      "Criterio proceso demo 84",
      "Criterio proceso demo 85",
      "Criterio proceso demo 86",
      "Criterio proceso demo 87",
      "Criterio proceso demo 88",
      "Criterio proceso demo 89",
      "Criterio proceso demo 90"
    ];

    let criteriosExpandido = false;

    function renderCriterios() {
      const lista = document.getElementById('listaCriterios');
      const resumen = document.getElementById('criteriaResumen');
      const btn = document.getElementById('btnVerMasCriteria');

      lista.innerHTML = '';
      CRITERIOS_PROCESOS.forEach((crit, idx) => {
        const li = document.createElement('li');
        li.className = 'criteria-item';

        const idxSpan = document.createElement('span');
        idxSpan.className = 'criteria-index';
        idxSpan.textContent = idx + 1;

        const textSpan = document.createElement('span');
        textSpan.className = 'criteria-text';
        textSpan.textContent = crit;

        li.appendChild(idxSpan);
        li.appendChild(textSpan);
        lista.appendChild(li);
      });

      if (!criteriosExpandido) {
        lista.style.maxHeight = '210px';
        resumen.textContent = `Listado completo de ${CRITERIOS_PROCESOS.length} criterios (scroll para ver m√°s)`;
        btn.textContent = 'Expandir a altura completa';
        btn.style.display = 'inline-block';
      } else {
        lista.style.maxHeight = 'none';
        resumen.textContent = `Mostrando todos los ${CRITERIOS_PROCESOS.length} criterios (alto ampliado)`;
        btn.textContent = 'Volver a vista reducida';
        btn.style.display = 'inline-block';
      }
    }

    document.getElementById('btnVerMasCriteria').addEventListener('click', () => {
      criteriosExpandido = !criteriosExpandido;
      renderCriterios();
    });

    // ---------- Toast helper ----------
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.classList.add('hide');
        setTimeout(() => toast.remove(), 300);
      }, 1800);
    }

    // ---------- Navegaci√≥n vistas ----------
    const sideNavButtons = document.querySelectorAll('.side-nav-item');
    const viewDashboard = document.getElementById('view-dashboard');
    const viewInformes = document.getElementById('view-informes');

    function activarVista(nombre) {
      if (nombre === 'dashboard') {
        viewDashboard.classList.add('active');
        viewInformes.classList.remove('active');
      } else {
        viewDashboard.classList.remove('active');
        viewInformes.classList.add('active');
      }
      sideNavButtons.forEach(btn => {
        if (btn.dataset.view === nombre) btn.classList.add('active');
        else btn.classList.remove('active');
      });
    }

    sideNavButtons.forEach(btn => {
      btn.addEventListener('click', () => activarVista(btn.dataset.view));
    });

    // ---------- Topbar / configuraci√≥n ----------
    const btnSaveView = document.getElementById('btnSaveView');
    const btnExportHtml = document.getElementById('btnExportHtml');
    const btnSyncCloud = document.getElementById('btnSyncCloud');
    const btnToggleTheme = document.getElementById('btnToggleTheme');
    const btnPrint = document.getElementById('btnPrint');
    const selectCentro = document.getElementById('selectCentro');
    const selectDelegado = document.getElementById('selectDelegado');
    const resumenSub = document.getElementById('resumenSub');

    const CONFIG_KEY = 'gestionarAudioConfig';

    function textoCentro(value) {
      const opt = selectCentro.querySelector(`option[value="${value}"]`);
      return opt ? opt.textContent : 'Centro: Todos';
    }

    function textoDelegado(value) {
      const opt = selectDelegado.querySelector(`option[value="${value}"]`);
      return opt ? opt.textContent : 'Delegado: Todos';
    }

    function actualizarTextoResumen() {
      const centroText = textoCentro(selectCentro.value);
      const delegadoText = textoDelegado(selectDelegado.value);
      resumenSub.textContent =
        'Visi√≥n r√°pida de procesos, HIT, primeros auxilios, conversiones y formaciones ¬∑ ' +
        centroText + ' ¬∑ ' + delegadoText + ' (datos demo)';
    }

    function applyTheme(theme) {
      if (theme === 'light') {
        document.body.classList.add('light-theme');
        btnToggleTheme.innerHTML = '<span class="icon">üåô</span> Modo oscuro';
      } else {
        document.body.classList.remove('light-theme');
        btnToggleTheme.innerHTML = '<span class="icon">‚òÄÔ∏è</span> Modo claro';
      }
    }

    function saveConfig() {
      const cfg = {
        theme: document.body.classList.contains('light-theme') ? 'light' : 'dark',
        centro: selectCentro.value,
        delegado: selectDelegado.value
      };
      try {
        localStorage.setItem(CONFIG_KEY, JSON.stringify(cfg));
      } catch (e) {
        console.warn('No se pudo guardar la configuraci√≥n', e);
      }
    }

    function loadConfig() {
      let cfg = null;
      try {
        const raw = localStorage.getItem(CONFIG_KEY);
        if (raw) cfg = JSON.parse(raw);
      } catch (e) {
        console.warn('No se pudo leer la configuraci√≥n', e);
      }

      if (cfg) {
        if (cfg.theme) applyTheme(cfg.theme);
        else applyTheme('dark');
        if (cfg.centro) selectCentro.value = cfg.centro;
        if (cfg.delegado) selectDelegado.value = cfg.delegado;
      } else {
        applyTheme('dark');
      }

      actualizarTextoResumen();
      actualizarEstadosKpi();
      renderCriterios();
    }

    // Clasificaci√≥n KPIs
    function actualizarEstadosKpi() {
      const kpiPills = document.querySelectorAll('.kpi-pill');
      kpiPills.forEach(pill => {
        const type = pill.getAttribute('data-kpi-type');
        const valueEl = pill.querySelector('.kpi-value');
        const statusWrapper = pill.querySelector('.kpi-status');
        const iconEl = statusWrapper.querySelector('.kpi-status-icon');
        if (!valueEl || !statusWrapper || !iconEl) return;

        const raw = valueEl.textContent.trim().replace('%', '');
        const value = parseFloat(raw);
        if (isNaN(value)) return;

        let estado = 'mejorable';
        let texto = 'Mejorable';
        let icon = 'üî¥';

        if (type === 'conversion') {
          if (value >= 80) {
            estado = 'optimo';
            texto = '√ìptimo';
            icon = 'üü¢';
          } else {
            estado = 'mejorable';
            texto = 'Mejorable';
            icon = 'üî¥';
          }
        } else {
          if (value >= 100) {
            estado = 'optimo';
            texto = '√ìptimo';
            icon = 'üü¢';
          } else if (value >= 85) {
            estado = 'muybien';
            texto = 'Muy bien';
            icon = 'üü°';
          } else {
            estado = 'mejorable';
            texto = 'Mejorable';
            icon = 'üî¥';
          }
        }

        statusWrapper.classList.remove('optimo', 'muybien', 'mejorable');
        statusWrapper.classList.add(estado);
        statusWrapper.title = texto + ' ¬∑ dato demo';
        iconEl.textContent = icon;
      });
    }

    // Eventos topbar
    btnToggleTheme.addEventListener('click', () => {
      const isLight = !document.body.classList.contains('light-theme');
      applyTheme(isLight ? 'light' : 'dark');
      saveConfig();
    });

    btnSaveView.addEventListener('click', () => {
      saveConfig();
      showToast('Preferencias guardadas en este navegador');
    });

    btnPrint.addEventListener('click', () => {
      window.print();
    });

    btnExportHtml.addEventListener('click', () => {
      try {
        const htmlCompleto = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
        const blob = new Blob([htmlCompleto], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'gestion-audio-dashboard-general.html';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        showToast('HTML exportado (descarga iniciada)');
      } catch (e) {
        console.error('Error exportando HTML', e);
        showToast('No se pudo exportar el HTML');
      }
    });

    btnSyncCloud.addEventListener('click', () => {
      showToast('Sincronizaci√≥n con la nube simulada (demo)');
    });

    selectCentro.addEventListener('change', () => {
      actualizarTextoResumen();
      saveConfig();
    });

    selectDelegado.addEventListener('change', () => {
      actualizarTextoResumen();
      saveConfig();
    });

    // ---------- Gestor de visitas: datos demo ----------
    const monthNamesEs = [
      'Enero','Febrero','Marzo','Abril','Mayo','Junio',
      'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'
    ];

    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();

    let centros = [
      'Madrid ¬∑ Reina Mercedes',
      'Madrid ¬∑ Tetu√°n',
      'Sevilla ¬∑ Nervi√≥n',
      'Bilbao ¬∑ Gran V√≠a'
    ];

    let visitasPendientes = [];
    let historialInformes = [];
    let modalFechaSeleccionada = null;

    const calMonthLabel = document.getElementById('calMonthLabel');
    const calendarGrid = document.getElementById('calendarGrid');
    const listaVisitasPendientes = document.getElementById('listaVisitasPendientes');
    const listaCentros = document.getElementById('listaCentros');
    const centrosListDatalist = document.getElementById('centrosList');

    function formatDateISO(year, month, day) {
      const mm = String(month + 1).padStart(2, '0');
      const dd = String(day).padStart(2, '0');
      return `${year}-${mm}-${dd}`;
    }

    function formatDateES(iso) {
      const [y,m,d] = iso.split('-').map(Number);
      return `${String(d).padStart(2,'0')}/${String(m).padStart(2,'0')}/${y}`;
    }

    function renderCalendar(year, month) {
      calMonthLabel.textContent = `${monthNamesEs[month]} ${year}`;
      calendarGrid.innerHTML = '';

      const firstDay = new Date(year, month, 1);
      const startingDay = (firstDay.getDay() + 6) % 7; // lunes=0
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      const dayNames = ['L','M','X','J','V','S','D'];
      dayNames.forEach(d => {
        const div = document.createElement('div');
        div.className = 'calendar-day-name';
        div.textContent = d;
        calendarGrid.appendChild(div);
      });

      for (let i = 0; i < startingDay; i++) {
        const cell = document.createElement('div');
        cell.className = 'calendar-cell calendar-cell-empty';
        calendarGrid.appendChild(cell);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const iso = formatDateISO(year, month, day);
        const cell = document.createElement('div');
        cell.className = 'calendar-cell';
        const span = document.createElement('span');
        span.className = 'date-number';
        span.textContent = day;
        cell.appendChild(span);

        const todayISO = formatDateISO(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());
        if (iso === todayISO) {
          cell.classList.add('calendar-cell-today');
        }

        if (visitasPendientes.some(v => v.fecha === iso)) {
          const dot = document.createElement('div');
          dot.className = 'calendar-dot';
          cell.appendChild(dot);
        }

        cell.dataset.date = iso;
        cell.addEventListener('click', () => abrirModalVisita(iso));
        calendarGrid.appendChild(cell);
      }
    }

    function renderCentros() {
      listaCentros.innerHTML = '';
      centrosListDatalist.innerHTML = '';
      centros.forEach(c => {
        const li = document.createElement('li');
        li.textContent = c;
        listaCentros.appendChild(li);

        const opt = document.createElement('option');
        opt.value = c;
        centrosListDatalist.appendChild(opt);
      });
    }

    function renderVisitasPendientes() {
      listaVisitasPendientes.innerHTML = '';
      if (!visitasPendientes.length) {
        const p = document.createElement('p');
        p.className = 'pending-empty';
        p.textContent = 'No hay visitas pendientes (demo).';
        listaVisitasPendientes.appendChild(p);
        return;
      }
      visitasPendientes
        .slice()
        .sort((a,b) => a.fecha.localeCompare(b.fecha))
        .forEach(v => {
          const row = document.createElement('div');
          row.className = 'pending-row';

          const spanFecha = document.createElement('span');
          spanFecha.className = 'pending-date';
          spanFecha.textContent = formatDateES(v.fecha);

          const spanCentro = document.createElement('span');
          spanCentro.className = 'pending-centro';
          spanCentro.textContent = v.centro;

          const status = document.createElement('span');
          status.className = 'pending-status';
          status.textContent = 'Pendiente';

          const btn = document.createElement('button');
          btn.className = 'pending-btn';
          btn.textContent = 'Crear informe';
          btn.addEventListener('click', () => {
            activarVista('informes');
            cargarDatosInformeDesdeVisita(v);
          });

          row.appendChild(spanFecha);
          row.appendChild(spanCentro);
          row.appendChild(status);
          row.appendChild(btn);
          listaVisitasPendientes.appendChild(row);
        });
    }

    function renderHistorialInformes() {
      const ul = document.getElementById('historialInformesList');
      ul.innerHTML = '';
      if (!historialInformes.length) {
        const li = document.createElement('li');
        li.className = 'historial-item';
        li.textContent = 'A√∫n no hay informes guardados en esta sesi√≥n (demo).';
        ul.appendChild(li);
        return;
      }
      historialInformes
        .slice()
        .sort((a,b) => b.timestamp.localeCompare(a.timestamp))
        .forEach(inf => {
          const li = document.createElement('li');
          li.className = 'historial-item';
          li.textContent = `${inf.fecha || 'Fecha sin definir'} ¬∑ ${inf.centro || 'Centro'} ¬∑ ${inf.responsable || 'Responsable'} ¬∑ ${inf.tipoCentro || 'Tipo'} (${inf.centroAar || 'AAR n/d'})`;
          ul.appendChild(li);
        });
    }

    // ---------- Modal agendar visita ----------
    const visitModal = document.getElementById('visitModal');
    const visitModalFecha = document.getElementById('visitModalFecha');
    const visitCentroInput = document.getElementById('visitCentroInput');
    const visitResponsableSelect = document.getElementById('visitResponsableSelect');
    const btnCancelarVisita = document.getElementById('btnCancelarVisita');
    const btnGuardarVisitaModal = document.getElementById('btnGuardarVisitaModal');

    function abrirModalVisita(isoFecha) {
      modalFechaSeleccionada = isoFecha;
      visitModalFecha.textContent = formatDateES(isoFecha);
      visitCentroInput.value = '';
      visitResponsableSelect.value = '';
      visitModal.classList.add('active');
      visitModal.setAttribute('aria-hidden', 'false');
    }

    function cerrarModalVisita() {
      visitModal.classList.remove('active');
      visitModal.setAttribute('aria-hidden', 'true');
    }

    btnCancelarVisita.addEventListener('click', () => cerrarModalVisita());

    btnGuardarVisitaModal.addEventListener('click', () => {
      const centro = visitCentroInput.value.trim();
      const responsable = visitResponsableSelect.value;
      if (!modalFechaSeleccionada || !centro || !responsable) {
        alert('Selecciona centro y responsable Audio para agendar la visita (demo).');
        return;
      }
      visitasPendientes.push({
        id: Date.now(),
        fecha: modalFechaSeleccionada,
        centro,
        responsable
      });
      cerrarModalVisita();
      renderVisitasPendientes();
      renderCalendar(currentYear, currentMonth);
      showToast('Visita agendada (demo)');
    });

    visitModal.addEventListener('click', (ev) => {
      if (ev.target === visitModal) cerrarModalVisita();
    });

    // ---------- Eventos calendario / centros ----------
    document.getElementById('calPrev').addEventListener('click', () => {
      if (currentMonth === 0) {
        currentMonth = 11;
        currentYear--;
      } else currentMonth--;
      renderCalendar(currentYear, currentMonth);
    });

    document.getElementById('calNext').addEventListener('click', () => {
      if (currentMonth === 11) {
        currentMonth = 0;
        currentYear++;
      } else currentMonth++;
      renderCalendar(currentYear, currentMonth);
    });

    document.getElementById('inputExcelCentros').addEventListener('change', () => {
      showToast('Fichero Excel de centros registrado (lectura demo pendiente)');
    });

    document.getElementById('btnAddCentro').addEventListener('click', () => {
      const input = document.getElementById('nuevoCentroInput');
      const value = input.value.trim();
      if (!value) return;
      centros.push(value);
      input.value = '';
      renderCentros();
      showToast('Centro a√±adido al listado demo');
    });

    // ---------- Informe de visitas: gr√°ficas ----------
    const radarCtx = document.getElementById('chartRadarInforme').getContext('2d');
    const chartRadarInforme = new Chart(radarCtx, {
      type: 'radar',
      data: {
        labels: ['Formaciones', 'Conv. venta', 'Conv. prueba', 'Aplicaci√≥n procesos'],
        datasets: [{
          label: '% demo',
          data: [78, 82, 75, 88],
          borderColor: '#ef4444',
          backgroundColor: 'rgba(239,68,68,0.25)',
          borderWidth: 2,
          pointRadius: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          r: {
            angleLines: { color: 'rgba(148,163,184,0.5)' },
            grid: { color: 'rgba(148,163,184,0.5)' },
            ticks: {
              display: true,
              showLabelBackdrop: false,
              color: '#9ca3af',
              callback: value => value + '%'
            },
            pointLabels: {
              color: '#e5e7eb',
              font: { size: 10, weight: 'bold' }
            },
            suggestedMin: 0,
            suggestedMax: 100
          }
        },
        plugins: {
          legend: {
            labels: { color: '#e5e7eb', font: { size: 10, weight: 'bold' } }
          }
        }
      }
    });

    const areaInfCtx = document.getElementById('chartAreaMejoraInforme').getContext('2d');
    const chartAreaMejoraInforme = new Chart(areaInfCtx, {
      type: 'bar',
      data: {
        labels: [
          'Seguimiento a 7 d√≠as',
          'Entrega folleto HIT',
          'Simulaci√≥n financiaci√≥n',
          'Registro motivo no venta',
          'Plan fidelizaci√≥n'
        ],
        datasets: [{
          label: '% procesos no aplicados (f=0)',
          data: [40, 35, 28, 26, 22],
          backgroundColor: 'rgba(239,68,68,0.9)',
          borderRadius: 6
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: '#e5e7eb', font: { size: 10, weight: 'bold' } }
          },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.parsed.x}% no aplicado`
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 },
              callback: value => value + '%'
            },
            grid: { color: 'rgba(31,41,55,0.4)' },
            suggestedMin: 0,
            suggestedMax: 100
          },
          y: {
            ticks: { color: '#9ca3af', font: { size: 10 } },
            grid: { display: false }
          }
        }
      }
    });

    const kpiInfCtx = document.getElementById('chartKpiInforme').getContext('2d');
    const chartKpiInforme = new Chart(kpiInfCtx, {
      type: 'bar',
      data: {
        labels: ['HIT', 'AAR', 'Tchin Tchin', 'Seguros', 'Infinity', 'Stock', 'Formaci√≥n RT', 'Primeros auxilios'],
        datasets: [{
          label: '% demo',
          data: [91, 74, 63, 58, 69, 82, 77, 65],
          backgroundColor: [
            'rgba(239,68,68,0.9)',
            'rgba(59,130,246,0.9)',
            'rgba(234,179,8,0.9)',
            'rgba(16,185,129,0.9)',
            'rgba(168,85,247,0.9)',
            'rgba(107,114,128,0.9)',
            'rgba(14,165,233,0.9)',
            'rgba(244,63,94,0.9)'
          ],
          borderRadius: 5
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: '#e5e7eb', font: { size: 10, weight: 'bold' } }
          },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y}%`
            }
          }
        },
        scales: {
          x: {
            ticks: { color: '#9ca3af', font: { size: 9 } },
            grid: { color: 'rgba(31,41,55,0.35)' }
          },
          y: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 },
              callback: value => value + '%'
            },
            grid: { color: 'rgba(31,41,55,0.35)' },
            suggestedMin: 40,
            suggestedMax: 100
          }
        }
      }
    });

    // ---------- Cargar datos informe desde visita ----------
    function cargarDatosInformeDesdeVisita(v) {
      document.getElementById('informeCentro').value = v.centro;
      document.getElementById('informeResponsableAudio').value = v.responsable;
      document.getElementById('informeFecha').value = v.fecha;
      // el delegado se completar√° manualmente
      document.getElementById('informeCentro').focus();
      document.getElementById('informeVisitasSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // ---------- Guardar informe ----------
    document.getElementById('btnGuardarInforme').addEventListener('click', () => {
      const informe = {
        id: Date.now(),
        centro: document.getElementById('informeCentro').value.trim(),
        delegado: document.getElementById('informeDelegado').value.trim(),
        responsable: document.getElementById('informeResponsableAudio').value,
        fecha: document.getElementById('informeFecha').value,
        tipoCentro: document.getElementById('informeTipoCentro').value,
        centroAar: document.getElementById('informeCentroAAR').value,
        observaciones: document.getElementById('informeObservaciones').value.trim(),
        timestamp: new Date().toISOString()
      };

      historialInformes.push(informe);
      renderHistorialInformes();
      showToast('Informe guardado en historial (demo local)');
    });

    // ---------- Inicializaci√≥n ----------
    function initGestorVisitas() {
      renderCentros();
      renderVisitasPendientes();
      renderCalendar(currentYear, currentMonth);
      renderHistorialInformes();
    }

    loadConfig();
    initGestorVisitas();
  </script>
</body>
</html>
